(function(){"use strict";var e={4271:function(e,t,o){var s=o(5471),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("el-row",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}]},[t("ChatRoom")],1)],1)},n=[],a=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-dialog",{attrs:{title:"登录",visible:e.LoginFormVisible,modal:!0,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.LoginFormVisible=t}}},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules}},[t("el-form-item",{attrs:{prop:"userName"}},[t("el-input",{attrs:{placeholder:"username"},model:{value:e.ruleForm.userName,callback:function(t){e.$set(e.ruleForm,"userName",t)},expression:"ruleForm.userName"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{type:"password",placeholder:"password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitForm("ruleForm")}},model:{value:e.ruleForm.password,callback:function(t){e.$set(e.ruleForm,"password",t)},expression:"ruleForm.password"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.submitForm(e.ruleForm)}}},[e._v("登 录")])],1)],1),t("el-main",[t("el-row",{attrs:{type:"flex",justify:"",center:""}},[t("el-col",{attrs:{span:9}},[t("div",{staticStyle:{height:"500px"}},[t("ul",e._l(e.messageList,(function(o){return t("li",{key:o.time},[t("el-card",{attrs:{shadow:"hover"}},[t("el-row",{attrs:{type:"flex",justify:"start"}},[t("h4",[e._v(" ["+e._s(o.user)+"] "),t("strong",[e._v(" "+e._s(o.time))])])]),t("el-row",{attrs:{type:"flex",justify:"start"}},[t("h1",[e._v(" "+e._s(o.content)+" ")])])],1)],1)})),0)])])],1)],1),t("el-footer",[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.MesssageSender}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"send something..."},model:{value:e.MesssageSender.content,callback:function(t){e.$set(e.MesssageSender,"content",t)},expression:"MesssageSender.content"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.send}},[e._v("Send")])],1)],1),t("el-row",[t("el-button",{attrs:{type:"danger",size:"small",plain:"",round:""},on:{click:e.Logout}},[e._v("Logout")])],1)],1)],1)],1)},l=[],i=o(1250),u={name:"ChatRoom",data:function(){return{LoginFormVisible:!0,token:"",clientPublicKey:-1,clientPrivateKey:-1,messageList:{},MesssageSender:{content:""},ruleForm:{userName:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},mounted(){this.LoginFormVisible=null==localStorage.getItem("user"),""!=localStorage.getItem("token")&&this.getMessageList()},methods:{getMessageList(){i.A.get("/api/Messages",{params:{token:localStorage.getItem("token")}}).then((e=>{console.log("getMessage"),console.log(e),this.messageList=e.data.messages})).catch((e=>{console.log(e)}))},swapDHkey(){this.clientPrivateKey=Math.floor(Math.random()*this.q)+1,this.clientPublicKey=Math.pow(this.a,this.clientPrivateKey),i.A.post("/api/swapDHKey",{token:this.token,clientPublicKey:this.clientPublicKey}).then((e=>{console.log("swapDHKey response"),console.log(e),"success"===e.data.status?(console.log("serverPublicKey"+e.data.serverPublicKey),this.sharedKey=Math.pow(e.data.serverPublicKey,this.clientPrivateKey)%this.q,console.log("sharedKey"+this.sharedKey),this.LoginFormVisible=!1,this.getMessageList()):(alert("登录过期！"),this.LoginFormVisible=!0)})).catch((e=>{console.log(e)}))},submitForm(e){console.log(e),i.A.get("/api/login",{params:{userName:this.ruleForm.userName,password:this.ruleForm.password}}).then((e=>{console.log(e),console.log(e.data.valid),!0===e.data.valid?(console.log("login success"),this.LoginFormVisible=!1,this.token=e.data.token,localStorage.setItem("user",this.ruleForm.userName),localStorage.setItem("token",this.token),this.a=e.data.a,this.q=e.data.q,this.swapDHkey()):(alert("账号或密码错误！"),this.ruleForm.userName="",this.ruleForm.password="")})).catch((e=>{console.log(e)}))},send(){i.A.post("/api/sendMessages",{token:localStorage.getItem("token"),userName:localStorage.getItem("user"),content:this.MesssageSender.content}).then((e=>{console.log("SendMessage"),console.log(e),this.getMessageList(),this.MesssageSender.content=""})).catch((e=>{console.log(e)}))},Logout(){localStorage.removeItem("user"),localStorage.removeItem("token"),location.reload()}}},c=u,d=o(1656),m=(0,d.A)(c,a,l,!1,null,"26c3814a",null),f=m.exports,g={name:"App",components:{ChatRoom:f},data:function(){return{}},methods:{}},h=g,p=(0,d.A)(h,r,n,!1,null,null,null),v=p.exports,y=o(1052),b=o.n(y),w=o(6278);s["default"].use(w.Ay);const k=new w.Ay.Store({state:{user:"",token:""}});var F=k;s["default"].use(b()),s["default"].config.productionTip=!1,s["default"].use(w.Ay),new s["default"]({render:e=>e(v),store:F}).$mount("#app")}},t={};function o(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={id:s,loaded:!1,exports:{}};return e[s](n,n.exports,o),n.loaded=!0,n.exports}o.m=e,function(){o.amdO={}}(),function(){var e=[];o.O=function(t,s,r,n){if(!s){var a=1/0;for(c=0;c<e.length;c++){s=e[c][0],r=e[c][1],n=e[c][2];for(var l=!0,i=0;i<s.length;i++)(!1&n||a>=n)&&Object.keys(o.O).every((function(e){return o.O[e](s[i])}))?s.splice(i--,1):(l=!1,n<a&&(a=n));if(l){e.splice(c--,1);var u=r();void 0!==u&&(t=u)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,r,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,n,a=s[0],l=s[1],i=s[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(r in l)o.o(l,r)&&(o.m[r]=l[r]);if(i)var c=i(o)}for(t&&t(s);u<a.length;u++)n=a[u],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(c)},s=self["webpackChunksafechat_front"]=self["webpackChunksafechat_front"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=o.O(void 0,[504],(function(){return o(4271)}));s=o.O(s)})();
//# sourceMappingURL=app.89c48c71.js.map